<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<script>
function makeAjaxCall(url, methodType){
	   var promiseObj = new Promise(function(resolve, reject){
	      var xhr = new XMLHttpRequest();
	      xhr.open(methodType, url, true);
	      xhr.send();
	      xhr.onreadystatechange = function(){
	      if (xhr.readyState === 4){
	         if (xhr.status === 200){
	            console.log("xhr done successfully");
	            var resp = xhr.responseText;
	            var respJson = JSON.parse(resp);
	            resolve(respJson);
	         } else {
	            reject(xhr.status);
	            console.log("xhr failed");
	         }
	      } else {
	         console.log("xhr processing going on");
	      }
	   }
	   console.log("request sent succesfully");
	 });
	 return promiseObj;
	}


	function getdata(){
	 var URL = "https://api.myjson.com/bins/z6yrm";
	 makeAjaxCall(URL, "GET").then(processUserDetailsResponse, errorHandler);
	}
	
	function createCoursesTable(obj) {
		var len= obj.length;
		  var col = [];
		   for (var i = 0; i <len; i++) {
		        for (var key in obj[i]) {
		            if (col.indexOf(key) === -1) {
		               col.push(key);
		               }
		            }
		        }       
		        var table = document.createElement("table");
				var tr = table.insertRow(-1);                  
		        for (var i = 0; i < col.length; i++) {
		            var th = document.createElement("th");    
		            th.innerHTML = col[i];
		            tr.appendChild(th);
		        }
		        for (var i = 0; i <len; i++) {
				tr = table.insertRow(-1);
				for (var j = 0; j < col.length; j++) {
				var tabCell = tr.insertCell(-1);
		        tabCell.innerHTML = obj[i][col[j]];
		   		}
		var coursesContainer = document.getElementById("courses");
		if(coursesContainer.firstChild) {
		coursesContainer.replaceChild(table, coursesContainer.firstChild);
		} else {
		coursesContainer.appendChild(table);
		}
	}
}

	function processUserDetailsResponse(JSONData){
	 console.log("JSON File Array count", JSONData);
	 var len = JSONData.Students.length;
	 console.log(len);
	 var col = [];
     for (var i = 0; i <len; i++) {
         for (var key1 in JSONData.Students[i]) {
        	 console.log(key1);
             if (col.indexOf(key1) === -1) {
                 col.push(key1);
             }
         }
     }
     
     for(var k =0;k<col.length;k++){
    	 console.log(col[k]);
     }
     var table = document.createElement("table");
     var tr = table.insertRow(-1);
     
     for(var i=0;i<col.length;i++){
    	 var th = document.createElement("th");    
         th.innerHTML = col[i];
         tr.appendChild(th); 
     }
       
     for (var i = 0; i <len; i++) {
        tr = table.insertRow(-1);
        for (var j = 0; j < col.length; j++) {
        	console.log(col[j]);
		if(col[j]==="courses"){
		var tabCell = tr.insertCell(-1);
		const newObj = JSONData.Students[i][col[j]]
		var button = document.createElement("button");
		button.innerHTML = "View Courses";
		button.onclick = () => {createCoursesTable(newObj)}
		tabCell.appendChild(button)
		}
        else{
			var tabCell = tr.insertCell(-1);
             tabCell.innerHTML = JSONData.Students[i][col[j]];
			}
         }
     }
    	
     document.getElementById("showData").appendChild(table);
	}
	function errorHandler(statusCode){
	 console.log("failed with status", status);
	}
</script>
</head>
<body onload="getdata()">
<p id="showData"></p>
<p id="courses"></p>
</body>
</html>